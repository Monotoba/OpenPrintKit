{
  "$schema": "https://json-schema.org/draft/2020-12/schema",
  "title": "OPK PDL (Printer Description Language)",
  "type": "object",
  "required": ["pdl_version","id","name","firmware","kinematics","geometry"],
  "properties": {
    "pdl_version": {"type":"string"},
    "id": {"type":"string"},
    "name":{"type":"string"},
    "firmware":{"type":"string","enum":["marlin","klipper","reprap","rrf","smoothie","bambu","crealityos","other"]},
    "kinematics":{"type":"string","enum":["cartesian","corexy","corexz","delta","scara","polar"]},
    "geometry":{
      "type":"object",
      "required":["bed_shape","z_height"],
      "properties":{
        "bed_shape":{"type":"array","minItems":3,"items":{"type":"array","minItems":2,"maxItems":2,"items":{"type":"number"}}},
        "z_height":{"type":"number","exclusiveMinimum":0},
        "origin":{"type":"string"}
      }
    },
    "limits":{
      "type":"object",
      "properties":{
        "print_speed_max": {"type":"number","minimum":1},
        "travel_speed_max": {"type":"number","minimum":1},
        "acceleration_max": {"type":"number","minimum":1},
        "jerk_max": {"type":"number","minimum":0}
      },
      "additionalProperties": true
    },
    "extruders":{
      "type":"array",
      "minItems":1,
      "items":{
        "type":"object",
        "required":["nozzle_diameter"],
        "properties":{
          "id":{"type":"string"},
          "nozzle_diameter":{"type":"number","minimum":0.1,"maximum":2.0},
          "nozzle_type":{"type":"string","enum":["brass","hardened_steel","stainless","ruby","tungsten","other"]},
          "drive":{"type":"string","enum":["direct","bowden","other"]},
          "max_nozzle_temperature":{"type":"number","minimum":100,"maximum":400},
          "mixing_channels":{"type":"integer","minimum":1,"default":1},
          "supported_filaments":{"type":"array","items":{"type":"string"}}
        },
        "additionalProperties": true
      }
    },
    "multi_material":{
      "type":"object",
      "properties":{
        "spool_banks":{
          "type":"array",
          "items":{
            "type":"object",
            "required":["name","capacity"],
            "properties":{
              "name":{"type":"string"},
              "capacity":{"type":"integer","minimum":1}
            },
            "additionalProperties": false
          }
        }
      },
      "additionalProperties": true
    },
    "features":{
      "type":"object",
      "properties":{
        "auto_bed_leveling":{"type":"boolean"},
        "probe":{
          "type":"object",
          "properties":{
            "type":{"type":"string","enum":["inductive","bltouch","crt","strain_gauge","nozzle_contact","manual","other"]},
            "mesh_size":{"type":"array","minItems":2,"maxItems":2,"items":{"type":"integer","minimum":1}},
            "active_low":{"type":"boolean"}
          },
          "additionalProperties": true
        }
      },
      "additionalProperties": true
    },
    "endstops":{
      "type":"object",
      "properties":{
        "x_min_active_low":{"type":"boolean"},
        "x_max_active_low":{"type":"boolean"},
        "y_min_active_low":{"type":"boolean"},
        "y_max_active_low":{"type":"boolean"},
        "z_min_active_low":{"type":"boolean"},
        "z_max_active_low":{"type":"boolean"}
      },
      "additionalProperties": true
    },
    "gcode":{
      "type":"object",
      "properties":{
        "start":{"type":"array","items":{"type":"string"}},
        "end":{"type":"array","items":{"type":"string"}},
        "tool_change":{"type":"array","items":{"type":"string"}},
        "before_tool_change":{"type":"array","items":{"type":"string"}},
        "after_tool_change":{"type":"array","items":{"type":"string"}},
        "layer_change":{"type":"array","items":{"type":"string"}},
        "before_layer_change":{"type":"array","items":{"type":"string"}},
        "after_layer_change":{"type":"array","items":{"type":"string"}},
        "pause":{"type":"array","items":{"type":"string"}},
        "resume":{"type":"array","items":{"type":"string"}},
        "filament_change":{"type":"array","items":{"type":"string"}},
        "before_object":{"type":"array","items":{"type":"string"}},
        "after_object":{"type":"array","items":{"type":"string"}},
        "before_region":{"type":"array","items":{"type":"string"}},
        "after_region":{"type":"array","items":{"type":"string"}},
        "retraction":{"type":"array","items":{"type":"string"}},
        "unretraction":{"type":"array","items":{"type":"string"}},
        "travel_start":{"type":"array","items":{"type":"string"}},
        "travel_end":{"type":"array","items":{"type":"string"}},
        "bridge_start":{"type":"array","items":{"type":"string"}},
        "bridge_end":{"type":"array","items":{"type":"string"}},
        "top_layer_start":{"type":"array","items":{"type":"string"}},
        "bottom_layer_start":{"type":"array","items":{"type":"string"}},
        "support_interface_start":{"type":"array","items":{"type":"string"}},
        "support_interface_end":{"type":"array","items":{"type":"string"}},
        "before_heating":{"type":"array","items":{"type":"string"}},
        "after_heating":{"type":"array","items":{"type":"string"}},
        "before_cooling":{"type":"array","items":{"type":"string"}},
        "on_abort":{"type":"array","items":{"type":"string"}},
        "on_progress_percent":{"type":"array","items":{"type":"string"}},
        "on_layer_interval":{"type":"array","items":{"type":"string"}},
        "on_time_interval":{"type":"array","items":{"type":"string"}},
        "before_snapshot":{"type":"array","items":{"type":"string"}},
        "after_snapshot":{"type":"array","items":{"type":"string"}},
        "power_loss_resume":{"type":"array","items":{"type":"string"}},
        "auto_shutdown":{"type":"array","items":{"type":"string"}},
        "macros":{
          "type":"object",
          "patternProperties":{
            "^[A-Za-z_][A-Za-z0-9_-]*$": {"type":"array","items":{"type":"string"}}
          },
          "additionalProperties": true
        },
        "hooks":{
          "type":"object",
          "patternProperties":{
            "^[a-z0-9_.-]+$": {"type":"array","items":{"type":"string"}}
          },
          "additionalProperties": true
        }
      },
      "additionalProperties": true
    }
    ,
    "materials":{
      "type":"array",
      "items":{
        "type":"object",
        "required":["name","filament_type"],
        "properties":{
          "name":{"type":"string"},
          "filament_type":{"type":"string"},
          "filament_diameter":{"type":"number"},
          "nozzle_temperature":{"type":"number","minimum":150,"maximum":350},
          "bed_temperature":{"type":"number","minimum":0,"maximum":150},
          "retraction_length":{"type":"number","minimum":0,"maximum":10},
          "retraction_speed":{"type":"number","minimum":1,"maximum":200},
          "fan_speed":{"type":"number","minimum":0,"maximum":100},
          "color":{"type":"string"},
          "color_hex":{"type":"string","pattern":"^#?[0-9A-Fa-f]{6}$"}
        },
        "additionalProperties": true
      }
    }
    ,
    "machine_control":{
      "type":"object",
      "properties":{
        "psu_on_start":{"type":"boolean"},
        "psu_off_end":{"type":"boolean"},
        "light_on_start":{"type":"boolean"},
        "light_off_end":{"type":"boolean"},
        "rgb_start":{"type":"object","properties":{
          "r":{"type":"integer","minimum":0,"maximum":255},
          "g":{"type":"integer","minimum":0,"maximum":255},
          "b":{"type":"integer","minimum":0,"maximum":255}
        },"additionalProperties":false},
        "chamber":{"type":"object","properties":{
          "temp":{"type":"number","minimum":0,"maximum":120},
          "wait":{"type":"boolean"}
        },"additionalProperties":false},
        "camera":{"type":"object","properties":{
          "use_before_snapshot":{"type":"boolean"},
          "use_after_snapshot":{"type":"boolean"},
          "command":{"type":"string"}
        },"additionalProperties":false},
        "sd_logging":{"type":"object","properties":{
          "enable_start":{"type":"boolean"},
          "filename":{"type":"string"},
          "stop_at_end":{"type":"boolean"}
        },"additionalProperties":false},
        "fans":{"type":"object","properties":{
          "part_start_percent":{"type":"number","minimum":0,"maximum":100},
          "aux_index":{"type":"integer","minimum":0},
          "aux_start_percent":{"type":"number","minimum":0,"maximum":100},
          "off_at_end":{"type":"boolean"}
        },"additionalProperties":false},
        "enable_mesh_start":{"type":"boolean"},
        "z_offset":{"type":"number"},
        "start_custom":{"type":"array","items":{"type":"string"}},
        "end_custom":{"type":"array","items":{"type":"string"}}
      },
      "additionalProperties": true
    }
  },
  "additionalProperties": true
}
